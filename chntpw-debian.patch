--- chntpw-0.99.1-030126.orig/Makefile
+++ chntpw-0.99.1-030126/Makefile
@@ -15,16 +15,13 @@
 CFLAGS= -DUSEOPENSSL -g -I. -I$(OSSLINC) -Wall
 
 # This is to link with whatever we have, SSL crypto lib we put in static
-LIBS=-L$(OSSLLIB) $(OSSLLIB)/libcrypto.a
+LIBS=-L$(OSSLLIB) -lcrypto
 
 # ** This is for linking with older and more lean libc than installed as default
 #    in RH7+ or newer Mandrakes. And probably others. GLIBC has BLOATED!
 # Use the reloc (and force it) in rpm to install into /usr/local :)
 
 #LIBS=-L$(OSSLLIB) -L/usr/local/libold -L/usr/local/usr/lib \
-$(OSSLLIB)/libcrypto.so /usr/local/usr/lib/crt1.o /usr/local/usr/lib/crti.o \
-/usr/local/libold/ld-2.0.5.so \
-/usr/local/usr/lib/libc.so /usr/local/libold/libc-2.0.5.so /usr/local/usr/lib/crtn.o 
 
 all: chntpw
 
--- chntpw-0.99.1-030126.orig/chntpw.8
+++ chntpw-0.99.1-030126/chntpw.8
@@ -0,0 +1,96 @@
+.\"                                      Hey, EMACS: -*- nroff -*-
+.\" First parameter, NAME, should be all caps
+.\" Second parameter, SECTION, should be 1-8, maybe w/ subsection
+.\" other parameters are allowed: see man(7), man(1)
+.TH CHNTPW 8  "30th May  2002"
+.\" Please adjust this date whenever revising the manpage.
+.\"
+.\" Some roff macros, for reference:
+.\" .nh        disable hyphenation
+.\" .hy        enable hyphenation
+.\" .ad l      left justify
+.\" .ad b      justify to both left and right margins
+.\" .nf        disable filling
+.\" .fi        enable filling
+.\" .br        insert line break
+.\" .sp <n>    insert n+1 empty lines
+.\" for manpage-specific macros, see man(7)
+.SH NAME
+chntpw \- utility to overwrite Windows NT/2000 SAM passwords
+.SH SYNOPSIS
+.B chntpw
+.RI [ options ]
+.RI < samfile > 
+.RI [ systemfile ]
+.RI [ securityfile ]
+.RI [ otherreghive ] 
+.RI [...]
+.br
+.SH DESCRIPTION
+This manual page documents briefly the
+.B chntpw
+command.
+This manual page was written for the Debian distribution
+because the original program does not have a manual page.
+.PP
+.B chntpw
+is a utility to view some information and change user passwords 
+in a Windows NT/2000 SAM userdatabase file. It is not necessary to
+know the old passwords to reset them.  In addition it contains a 
+simple registry editor (same size data writes)
+and hex-editor with which the information contained in a registry
+file can be browsed and modified.
+.SH OPTIONS
+.TP
+.B \-h
+Show summary of options.
+.TP
+.B \-u username
+Username to change. Default is Administrator
+.TP
+.B \-l
+List all users in the SAM database.
+.TP
+.B \-i
+Interactive: list all users (as per -l) and then ask for the 
+user to change.
+.TP
+.B \-e
+Registry editor with limited capabilities.
+.TP
+.B \-d
+Use buffer debugger.
+.TP
+.B \-t
+Show hexdumps of structs/segments (deprecated debug function).
+.SH EXAMPLES
+.TP
+.B chntpw sam system
+Opens registry hives 
+.B sam 
+and 
+.B system
+and change administrator account. This will work even if the name
+has been changed or it has been localized (since different language
+versions of NT use different administrator names).
+.TP
+.B chntpw -u jabbathehutt mysam
+Prompts for password for 
+.B jabbathehutt
+and changes it in the 
+.B mysam
+registry file, if found (otherwise do nothing)
+.SH SEE ALSO
+If you are looking for an automated procedure for password 
+recovery, you might look at the bootdisks provided by the
+upstream author at
+.BR http://home.eunet.no/~pnordahl/ntpasswd/
+.br
+There is more information on how this program works available at
+.IR /usr/share/doc/chntpw
+. This information includes in-depth information on how the 
+registry works, what are syskeys and some other issues.
+.SH AUTHOR
+This manual page was written by 
+Javier Fernandez-Sanguino Peña <jfs@computer.org>,
+for the Debian GNU/Linux system (but may be used by others).
--- chntpw/chntpw.c	2004-08-18 17:42:01.000000000 -0300
+++ chntpw.new/chntpw.c	2005-04-09 18:58:34.000000000 -0300
@@ -511,7 +511,7 @@
 	printf("** LANMAN password IS however set. Will now install new password as NT pass instead.\n");
 	printf("** NOTE: Continue at own risk!\n");
 	ntpw_offs = lmpw_offs;
-	(unsigned int)*(vp+0xa8) = ntpw_offs - 0xcc;
+ 	*((unsigned int*)vp+0xa8) = ntpw_offs - 0xcc;
 	ntpw_len = 16;
 	lmpw_len = 0;
       }
@@ -621,14 +621,14 @@
 	   ntpw_len = 16;
 	   lmpw_len = 16;
 	   ntpw_offs -= 4;
-	   (unsigned int)*(vp+0xa8) = ntpw_offs - 0xcc;
+	   *((unsigned int*)vp+0xa8) = ntpw_offs - 0xcc;
 	   *(vp + 0xa0) = 16;
 	   *(vp + 0xac) = 16;
 	 }
 	 
 	 for (i = 0; i < 16; i++) {
-	   (unsigned char)*(vp+ntpw_offs+i) = despw[i];
-	   if (lmpw_len >= 16) (unsigned char)*(vp+lmpw_offs+i) = newlandes[i];
+	   *(vp+ntpw_offs+i) = (char)despw[i];
+	   if (lmpw_len >= 16) *(vp+lmpw_offs+i) = (char)newlandes[i];
 	 }
        } else {
 	 printf("Unable to set since it is blank.\n");
--- chntpw/ntreg.c	2004-08-18 17:42:02.000000000 -0300
+++ chntpw.new/ntreg.c	2005-04-09 19:07:50.000000000 -0300
@@ -2514,7 +2514,7 @@
   ALLOC(kr,1,sizeof(int)+sizeof(int));
   
   kr->len = sizeof(int);
-  (int)kr->data = dword;
+  kr->data = dword;
 
   r = put_buf2val(hdesc, kr, vofs, path, REG_DWORD);
 
